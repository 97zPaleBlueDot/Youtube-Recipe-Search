---
description: 추후 모델링, 중복 데이터 제거 둘로 페이지 분리도 고려
---

# 데이터 모델링과 품질 관리
<!-- <figure><img src="../.gitbook/assets/image (8).png" alt=""><figcaption></figcaption></figure> -->

### 0. Preview
'자린고비'는 한 가지 음식을 만들기 위해 필요한 재료의 총 가격을 다양한 유튜브 영상 레시피별로 비교하여 가장 저렴한 옵션으로 요리할 수 있는 방법을 알려주는 서비스입니다. 서비스를 구현하기 전에 유튜브로부터 레시피 정보를, 쿠팡으로부터 식재료의 단위 가격과 상품 정보를 수집해 데이터를 미리 구축해야 합니다.<br><br>

유튜브 검색 대상이 되는 음식명들은 공개된 음식명 데이터셋을 확보해 DB에 저장 후 활용했습니다. 재료명은 유튜브 레시피 정보로부터 도출되기에, **유튜브영상→레시피→재료(재료명, 단위, 용량)→쿠팡상품정보** 라는 **종속성**을 갖습니다.<br><br>


아래 글에 제시된 절차에 따라 요구사항을 작성하여 새롭게 모델링을 진행했으며, 최종적으로 서비스되는 데이터가 가공되기까지 과정을 3단계로 나누면서, 기존 스키마에서 존재하던 식별 관계 간 혼동을 없앴습니다.<br>
[DB 설계하는 법 (feat. 데이터 모델링)](https://yeongunheo.tistory.com/entry/DB-%EC%84%A4%EA%B3%84%ED%95%98%EB%8A%94-%EB%B2%95-feat-%EB%8D%B0%EC%9D%B4%ED%84%B0-%EB%AA%A8%EB%8D%B8%EB%A7%81)<br><br>

더불어 데이터를 삭제, 수정(PUT, DELETE, PATCH)할 일이 없는 이유로, 외래키 제약 조건을 하나도 추가하지 않았습니다.
<br><br><br>



### 1. raw_data: 원천 -> 유튜브/쿠팡 크롤링 ETL
#### 요구사항
- 유튜브영상을 생성할 수 있어야 한다.
  - 유튜브영상은 하나의 메뉴명과 매핑된다.
  - 유튜브영상은 하나의 URL 값을 갖는다.
- 쿠팡 상품 정보를 생성할 수 있어야 한다.
  - 하나의 상품 검색에 대해 단위 최저 가격을 갖는 상품 정보 1개만 저장한다.
  - 상품 정보에는 상품명, 단위와 단위 가격, 상품과 상품 이미지 url, 로켓 배송 또는 로켓 프레시 여부, 보관 방법, 유통기한, 묶음 상품 여부가 포함된다.
<br><br>

요구사항에 따라 메뉴명은 menu, 유튜브 영상은 youtube_vdo, 쿠팡 상품 정보는 product 테이블로 설계했습니다.
```sql
맨 나중에 코드 첨부
```
<br><br><br>


### 2. raw_data: ETL -> ELT
이전 프로세스에서는 전처리를 거치지 않은 유튜브 영상 정보 전체 text를 full_text 컬럼에 저장했습니다. 이 단계에서는 LLM의 도움을 받아 레시피 속 재료를 단위(unit), 양(quantity), 모호한 값(vague, '조금', '적당량' 같은 표기) 정보로 구분하여 저장합니다.<br><br>

이 때, "페퍼론치노 3개 (없으면 청양고추)", "간마늘 1/2스푼(12g)" 처럼 대체 재료, 단위, 양을 함께 표기해 알려주는 경우가 있습니다. 현재 스키마는 대체제 정보를 사용하도록 설계돼있지 않기 때문에 둘 중 한 가지 정보만 사용해야 하는데, 이 경우 그램(g)처럼 더 보편적이고 정확한 단위를 사용합니다. 보편성의 기준은 쿠팡 상품 크롤링 정보에 등장하는 단위인지 여부로 판단할 수 있습니다.
<br><br><br>



#### 요구사항
- 레시피를 생성/조회할 수 있어야 한다.
  - 레시피는 여러 개의 식재료를 갖는다.
  - 레시피는 인분 정보를 갖는다 (ex: 2인분)
- 식재료를 생성/조회할 수 있어야 한다.
  - 식재료는 재료명+양+단위 정보와, 단위가격 최저인 쿠팡 상품 정보를 갖는다.
  - 1개의 식재료는 재료명+양+단위로 이뤄진 대체 재료 정보를 가질 수 있다.
  - 모호한 단위/양 정보는 'vague' 컬럼에 저장 후, unit_conversion, quantity_conversion 테이블 속 값을 통해 단위와 양을 갖도록 변환한다.
<br><br>

요구사항에 따라 레시피는 recipe, 재료는 ingredient, 둘 간의 참조 테이블은 recipe_ingredient, 단위/양 변환 정보는 unit_conversion 테이블로 설계했습니다. ingredient 테이블은 자기 참조 관계를 갖습니다.<br><br>

```sql
맨 나중에 코드 첨부
```
<br><br><br>


### 3. 프로덕션
클라이언트와 가장 가깝고, 유저와 직결되는 정보를 모아 갖는 cheap_recipe 테이블을 정의했습니다. Http 요청/응답 쿼리가 발생할 때마다 JOIN 하는 걸 피하기 위해, JOIN 시 포함될 값들을 모아둔 테이블을 24시간 주기로 업데이트하며 사용합니다.
<br><br>

- cheap_recipe
  - recipe, youtube_vdo를 조인해 만들어집니다.
  - 메뉴별료 재료 가격 총액 최저가(min_total_price) 레시피 url을 저장합니다.
  - recipe_id 또는 menu명 컬럼을 통해 식재료 정보를 가져옵니다.
<br><br>

```sql
맨 나중에 코드 첨부
```